<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/editor/atto/plugins/image/yui/src/button/js/button.js - Moodle</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Moodle"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Bootstrap.Collapse.html">Bootstrap.Collapse</a></li>
            
                <li><a href="../classes/Bootstrap.Dropdown.html">Bootstrap.Dropdown</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotation.html">M.assignfeedback_editpdf.annotation</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationhighlight.html">M.assignfeedback_editpdf.annotationhighlight</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationline.html">M.assignfeedback_editpdf.annotationline</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationoval.html">M.assignfeedback_editpdf.annotationoval</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationpen.html">M.assignfeedback_editpdf.annotationpen</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationrectangle.html">M.assignfeedback_editpdf.annotationrectangle</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationstamp.html">M.assignfeedback_editpdf.annotationstamp</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.colourpicker.html">M.assignfeedback_editpdf.colourpicker</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.comment.html">M.assignfeedback_editpdf.comment</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.commentmenu.html">M.assignfeedback_editpdf.commentmenu</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.commentsearch.html">M.assignfeedback_editpdf.commentsearch</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.drawable.html">M.assignfeedback_editpdf.drawable</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.dropdown.html">M.assignfeedback_editpdf.dropdown</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.edit.html">M.assignfeedback_editpdf.edit</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.editor.html">M.assignfeedback_editpdf.editor</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.point.html">M.assignfeedback_editpdf.point</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.quickcomment.html">M.assignfeedback_editpdf.quickcomment</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.quickcommentlist.html">M.assignfeedback_editpdf.quickcommentlist</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.rect.html">M.assignfeedback_editpdf.rect</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.stamppicker.html">M.assignfeedback_editpdf.stamppicker</a></li>
            
                <li><a href="../classes/M.atto_accessibilitychecker.Button.html">M.atto_accessibilitychecker.Button</a></li>
            
                <li><a href="../classes/M.atto_accessibilityhelper.Button.html">M.atto_accessibilityhelper.Button</a></li>
            
                <li><a href="../classes/M.atto_align.button.html">M.atto_align.button</a></li>
            
                <li><a href="../classes/M.atto_backcolor.button.html">M.atto_backcolor.button</a></li>
            
                <li><a href="../classes/M.atto_bold.button.html">M.atto_bold.button</a></li>
            
                <li><a href="../classes/M.atto_charmap.button.html">M.atto_charmap.button</a></li>
            
                <li><a href="../classes/M.atto_clear.button.html">M.atto_clear.button</a></li>
            
                <li><a href="../classes/M.atto_collapse.button.html">M.atto_collapse.button</a></li>
            
                <li><a href="../classes/M.atto_emoticon.button.html">M.atto_emoticon.button</a></li>
            
                <li><a href="../classes/M.atto_equation.Button.html">M.atto_equation.Button</a></li>
            
                <li><a href="../classes/M.atto_fontcolor.button.html">M.atto_fontcolor.button</a></li>
            
                <li><a href="../classes/M.atto_html.button.html">M.atto_html.button</a></li>
            
                <li><a href="../classes/M.atto_image.Button.html">M.atto_image.Button</a></li>
            
                <li><a href="../classes/M.atto_indent.button.html">M.atto_indent.button</a></li>
            
                <li><a href="../classes/M.atto_italic.button.html">M.atto_italic.button</a></li>
            
                <li><a href="../classes/M.atto_link.button.html">M.atto_link.button</a></li>
            
                <li><a href="../classes/M.atto_managefiles.usedfiles.html">M.atto_managefiles.usedfiles</a></li>
            
                <li><a href="../classes/M.atto_media.Button.html">M.atto_media.Button</a></li>
            
                <li><a href="../classes/M.atto_noautolink.button.html">M.atto_noautolink.button</a></li>
            
                <li><a href="../classes/M.atto_orderedlist.button.html">M.atto_orderedlist.button</a></li>
            
                <li><a href="../classes/M.atto_rtl.button.html">M.atto_rtl.button</a></li>
            
                <li><a href="../classes/M.atto_strike.button.html">M.atto_strike.button</a></li>
            
                <li><a href="../classes/M.atto_subscript.button.html">M.atto_subscript.button</a></li>
            
                <li><a href="../classes/M.atto_superscript.button.html">M.atto_superscript.button</a></li>
            
                <li><a href="../classes/M.atto_table.Button.html">M.atto_table.Button</a></li>
            
                <li><a href="../classes/M.atto_title.button.html">M.atto_title.button</a></li>
            
                <li><a href="../classes/M.atto_underline.button.html">M.atto_underline.button</a></li>
            
                <li><a href="../classes/M.atto_undo.button.html">M.atto_undo.button</a></li>
            
                <li><a href="../classes/M.atto_unlink.button.html">M.atto_unlink.button</a></li>
            
                <li><a href="../classes/M.atto_unorderedlist.button.html">M.atto_unorderedlist.button</a></li>
            
                <li><a href="../classes/M.block_navigation.html">M.block_navigation</a></li>
            
                <li><a href="../classes/M.block_navigation.ActionKey.html">M.block_navigation.ActionKey</a></li>
            
                <li><a href="../classes/M.block_navigation.Branch.html">M.block_navigation.Branch</a></li>
            
                <li><a href="../classes/M.block_navigation.Tree.html">M.block_navigation.Tree</a></li>
            
                <li><a href="../classes/M.core.actionmenu.ActionMenu.html">M.core.actionmenu.ActionMenu</a></li>
            
                <li><a href="../classes/M.core.ajaxException.html">M.core.ajaxException</a></li>
            
                <li><a href="../classes/M.core.alert.html">M.core.alert</a></li>
            
                <li><a href="../classes/M.core.blockdraganddrop.BlockRegion.html">M.core.blockdraganddrop.BlockRegion</a></li>
            
                <li><a href="../classes/M.core.blockdraganddrop.LegacyManager.html">M.core.blockdraganddrop.LegacyManager</a></li>
            
                <li><a href="../classes/M.core.blockdraganddrop.Manager.html">M.core.blockdraganddrop.Manager</a></li>
            
                <li><a href="../classes/M.core.chooserdialogue.html">M.core.chooserdialogue</a></li>
            
                <li><a href="../classes/M.core.confirm.html">M.core.confirm</a></li>
            
                <li><a href="../classes/M.core.dialogue.html">M.core.dialogue</a></li>
            
                <li><a href="../classes/M.core.dock.ActionKey.html">M.core.dock.ActionKey</a></li>
            
                <li><a href="../classes/M.core.dock.Block.html">M.core.dock.Block</a></li>
            
                <li><a href="../classes/M.core.dock.Dock.html">M.core.dock.Dock</a></li>
            
                <li><a href="../classes/M.core.dock.DockedItem.html">M.core.dock.DockedItem</a></li>
            
                <li><a href="../classes/M.core.dock.Loader.html">M.core.dock.Loader</a></li>
            
                <li><a href="../classes/M.core.dock.Panel.html">M.core.dock.Panel</a></li>
            
                <li><a href="../classes/M.core.dock.TabHeightManager.html">M.core.dock.TabHeightManager</a></li>
            
                <li><a href="../classes/M.core.dragdrop.html">M.core.dragdrop</a></li>
            
                <li><a href="../classes/M.core.exception.html">M.core.exception</a></li>
            
                <li><a href="../classes/M.core.formchangechecker.html">M.core.formchangechecker</a></li>
            
                <li><a href="../classes/M.core.LockScroll.html">M.core.LockScroll</a></li>
            
                <li><a href="../classes/M.core.notification.html">M.core.notification</a></li>
            
                <li><a href="../classes/M.core.notification.info.html">M.core.notification.info</a></li>
            
                <li><a href="../classes/M.core.popuphelp.html">M.core.popuphelp</a></li>
            
                <li><a href="../classes/M.core.tooltip.html">M.core.tooltip</a></li>
            
                <li><a href="../classes/M.core.WidgetFocusAfterHide.html">M.core.WidgetFocusAfterHide</a></li>
            
                <li><a href="../classes/M.core_backup.backupselectall.html">M.core_backup.backupselectall</a></li>
            
                <li><a href="../classes/M.core_backup.confirmcancel.html">M.core_backup.confirmcancel</a></li>
            
                <li><a href="../classes/M.course.coursebase.html">M.course.coursebase</a></li>
            
                <li><a href="../classes/M.course.dragdrop.resource.html">M.course.dragdrop.resource</a></li>
            
                <li><a href="../classes/M.course.dragdrop.section.html">M.course.dragdrop.section</a></li>
            
                <li><a href="../classes/M.course.management.Category.html">M.course.management.Category</a></li>
            
                <li><a href="../classes/M.course.management.Console.html">M.course.management.Console</a></li>
            
                <li><a href="../classes/M.course.management.Course.html">M.course.management.Course</a></li>
            
                <li><a href="../classes/M.course.management.DragDrop.html">M.course.management.DragDrop</a></li>
            
                <li><a href="../classes/M.course.management.Item.html">M.course.management.Item</a></li>
            
                <li><a href="../classes/M.course.modchooser.html">M.course.modchooser</a></li>
            
                <li><a href="../classes/M.course.toolboxes.resources.html">M.course.toolboxes.resources</a></li>
            
                <li><a href="../classes/M.course.toolboxes.section.html">M.course.toolboxes.section</a></li>
            
                <li><a href="../classes/M.course.toolboxes.toolbox.html">M.course.toolboxes.toolbox</a></li>
            
                <li><a href="../classes/M.editor_atto.Editor.html">M.editor_atto.Editor</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorClean.html">M.editor_atto.EditorClean</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorFilepicker.html">M.editor_atto.EditorFilepicker</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorPlugin.html">M.editor_atto.EditorPlugin</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorPluginButtons.html">M.editor_atto.EditorPluginButtons</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorPluginDialogue.html">M.editor_atto.EditorPluginDialogue</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorSelection.html">M.editor_atto.EditorSelection</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorStyling.html">M.editor_atto.EditorStyling</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorTextArea.html">M.editor_atto.EditorTextArea</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorToolbar.html">M.editor_atto.EditorToolbar</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorToolbarNav.html">M.editor_atto.EditorToolbarNav</a></li>
            
                <li><a href="../classes/M.editor_atto.Menu.html">M.editor_atto.Menu</a></li>
            
                <li><a href="../classes/M.form.shortforms.html">M.form.shortforms</a></li>
            
                <li><a href="../classes/M.form.showadvanced.html">M.form.showadvanced</a></li>
            
                <li><a href="../classes/M.mod_quiz.autosave.html">M.mod_quiz.autosave</a></li>
            
                <li><a href="../classes/M.tool_capability.Search.html">M.tool_capability.Search</a></li>
            
                <li><a href="../classes/Moodle.core_course.util.html">Moodle.core_course.util</a></li>
            
                <li><a href="../classes/Moodle.core_course.util.cm.html">Moodle.core_course.util.cm</a></li>
            
                <li><a href="../classes/Moodle.core_course.util.section.html">Moodle.core_course.util.section</a></li>
            
                <li><a href="../classes/Moodle.theme_bootstrapbase.bootstrap.html">Moodle.theme_bootstrapbase.bootstrap</a></li>
            
                <li><a href="../classes/Y.BootstrapEngine.html">Y.BootstrapEngine</a></li>
            
                <li><a href="../classes/Y.Moodle.course.categoryexpander.html">Y.Moodle.course.categoryexpander</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/buttons.html">buttons</a></li>
            
                <li><a href="../modules/clean.html">clean</a></li>
            
                <li><a href="../modules/dialogue.html">dialogue</a></li>
            
                <li><a href="../modules/filepicker.html">filepicker</a></li>
            
                <li><a href="../modules/gallery-bootstrap-collapse.html">gallery-bootstrap-collapse</a></li>
            
                <li><a href="../modules/gallery-bootstrap-dropdown.html">gallery-bootstrap-dropdown</a></li>
            
                <li><a href="../modules/gallery-bootstrap-engine.html">gallery-bootstrap-engine</a></li>
            
                <li><a href="../modules/menu-base.html">menu-base</a></li>
            
                <li><a href="../modules/moodle-assignfeedback_editpdf-editor.html">moodle-assignfeedback_editpdf-editor</a></li>
            
                <li><a href="../modules/moodle-atto-managefiles-button.html">moodle-atto-managefiles-button</a></li>
            
                <li><a href="../modules/moodle-atto_accessibilitychecker-button.html">moodle-atto_accessibilitychecker-button</a></li>
            
                <li><a href="../modules/moodle-atto_accessibilityhelper-button.html">moodle-atto_accessibilityhelper-button</a></li>
            
                <li><a href="../modules/moodle-atto_align-button.html">moodle-atto_align-button</a></li>
            
                <li><a href="../modules/moodle-atto_backcolor-button.html">moodle-atto_backcolor-button</a></li>
            
                <li><a href="../modules/moodle-atto_bold-button.html">moodle-atto_bold-button</a></li>
            
                <li><a href="../modules/moodle-atto_charmap-button.html">moodle-atto_charmap-button</a></li>
            
                <li><a href="../modules/moodle-atto_clear-button.html">moodle-atto_clear-button</a></li>
            
                <li><a href="../modules/moodle-atto_collapse-button.html">moodle-atto_collapse-button</a></li>
            
                <li><a href="../modules/moodle-atto_emoticon-button.html">moodle-atto_emoticon-button</a></li>
            
                <li><a href="../modules/moodle-atto_html-button.html">moodle-atto_html-button</a></li>
            
                <li><a href="../modules/moodle-atto_image_alignment-button.html">moodle-atto_image_alignment-button</a></li>
            
                <li><a href="../modules/moodle-atto_indent-button.html">moodle-atto_indent-button</a></li>
            
                <li><a href="../modules/moodle-atto_italic-button.html">moodle-atto_italic-button</a></li>
            
                <li><a href="../modules/moodle-atto_link-button.html">moodle-atto_link-button</a></li>
            
                <li><a href="../modules/moodle-atto_managefiles-usedfiles.html">moodle-atto_managefiles-usedfiles</a></li>
            
                <li><a href="../modules/moodle-atto_media-button.html">moodle-atto_media-button</a></li>
            
                <li><a href="../modules/moodle-atto_noautolink-button.html">moodle-atto_noautolink-button</a></li>
            
                <li><a href="../modules/moodle-atto_orderedlist-button.html">moodle-atto_orderedlist-button</a></li>
            
                <li><a href="../modules/moodle-atto_rtl-button.html">moodle-atto_rtl-button</a></li>
            
                <li><a href="../modules/moodle-atto_strike-button.html">moodle-atto_strike-button</a></li>
            
                <li><a href="../modules/moodle-atto_subscript-button.html">moodle-atto_subscript-button</a></li>
            
                <li><a href="../modules/moodle-atto_superscript-button.html">moodle-atto_superscript-button</a></li>
            
                <li><a href="../modules/moodle-atto_table-button.html">moodle-atto_table-button</a></li>
            
                <li><a href="../modules/moodle-atto_title-button.html">moodle-atto_title-button</a></li>
            
                <li><a href="../modules/moodle-atto_underline-button.html">moodle-atto_underline-button</a></li>
            
                <li><a href="../modules/moodle-atto_undo-button.html">moodle-atto_undo-button</a></li>
            
                <li><a href="../modules/moodle-atto_unlink-button.html">moodle-atto_unlink-button</a></li>
            
                <li><a href="../modules/moodle-atto_unorderedlist-button.html">moodle-atto_unorderedlist-button</a></li>
            
                <li><a href="../modules/moodle-backup-backupselectall.html">moodle-backup-backupselectall</a></li>
            
                <li><a href="../modules/moodle-backup-confirmcancel.html">moodle-backup-confirmcancel</a></li>
            
                <li><a href="../modules/moodle-block_navigation-navigation.html">moodle-block_navigation-navigation</a></li>
            
                <li><a href="../modules/moodle-core-actionmenu.html">moodle-core-actionmenu</a></li>
            
                <li><a href="../modules/moodle-core-blockdraganddrop.html">moodle-core-blockdraganddrop</a></li>
            
                <li><a href="../modules/moodle-core-chooserdialogue.html">moodle-core-chooserdialogue</a></li>
            
                <li><a href="../modules/moodle-core-dock.html">moodle-core-dock</a></li>
            
                <li><a href="../modules/moodle-core-dragdrop.html">moodle-core-dragdrop</a></li>
            
                <li><a href="../modules/moodle-core-formchangechecker.html">moodle-core-formchangechecker</a></li>
            
                <li><a href="../modules/moodle-core-lockscroll.html">moodle-core-lockscroll</a></li>
            
                <li><a href="../modules/moodle-core-maintenancemodetimer.html">moodle-core-maintenancemodetimer</a></li>
            
                <li><a href="../modules/moodle-core-notification.html">moodle-core-notification</a></li>
            
                <li><a href="../modules/moodle-core-notification-ajaxexception.html">moodle-core-notification-ajaxexception</a></li>
            
                <li><a href="../modules/moodle-core-notification-alert.html">moodle-core-notification-alert</a></li>
            
                <li><a href="../modules/moodle-core-notification-confirm.html">moodle-core-notification-confirm</a></li>
            
                <li><a href="../modules/moodle-core-notification-dialogue.html">moodle-core-notification-dialogue</a></li>
            
                <li><a href="../modules/moodle-core-notification-exception.html">moodle-core-notification-exception</a></li>
            
                <li><a href="../modules/moodle-core-popuphelp.html">moodle-core-popuphelp</a></li>
            
                <li><a href="../modules/moodle-core-tooltip.html">moodle-core-tooltip</a></li>
            
                <li><a href="../modules/moodle-core-widget-focusafterhide.html">moodle-core-widget-focusafterhide</a></li>
            
                <li><a href="../modules/moodle-course-categoryexpander.html">moodle-course-categoryexpander</a></li>
            
                <li><a href="../modules/moodle-course-coursebase.html">moodle-course-coursebase</a></li>
            
                <li><a href="../modules/moodle-course-dragdrop.html">moodle-course-dragdrop</a></li>
            
                <li><a href="../modules/moodle-course-management.html">moodle-course-management</a></li>
            
                <li><a href="../modules/moodle-course-modchooser.html">moodle-course-modchooser</a></li>
            
                <li><a href="../modules/moodle-course-toolboxes.html">moodle-course-toolboxes</a></li>
            
                <li><a href="../modules/moodle-course-util.html">moodle-course-util</a></li>
            
                <li><a href="../modules/moodle-course-util-cm.html">moodle-course-util-cm</a></li>
            
                <li><a href="../modules/moodle-course-util-section.html">moodle-course-util-section</a></li>
            
                <li><a href="../modules/moodle-editor_atto-editor.html">moodle-editor_atto-editor</a></li>
            
                <li><a href="../modules/moodle-editor_atto-menu.html">moodle-editor_atto-menu</a></li>
            
                <li><a href="../modules/moodle-editor_atto-plugin.html">moodle-editor_atto-plugin</a></li>
            
                <li><a href="../modules/moodle-form-shortforms.html">moodle-form-shortforms</a></li>
            
                <li><a href="../modules/moodle-form-showadvanced.html">moodle-form-showadvanced</a></li>
            
                <li><a href="../modules/moodle-mod_quiz-autosave.html">moodle-mod_quiz-autosave</a></li>
            
                <li><a href="../modules/moodle-question-preview.html">moodle-question-preview</a></li>
            
                <li><a href="../modules/moodle-tool_capability-search.html">moodle-tool_capability-search</a></li>
            
                <li><a href="../modules/plugin-base.html">plugin-base</a></li>
            
                <li><a href="../modules/styling.html">styling</a></li>
            
                <li><a href="../modules/textarea.html">textarea</a></li>
            
                <li><a href="../modules/theme_bootstrapbase-bootstrap.html">theme_bootstrapbase-bootstrap</a></li>
            
                <li><a href="../modules/toolbar.html">toolbar</a></li>
            
                <li><a href="../modules/toolbarnav.html">toolbarnav</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/editor/atto/plugins/image/yui/src/button/js/button.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

/*
 * @package    atto_image
 * @copyright  2013 Damyon Wiese  &lt;damyon@moodle.com&gt;
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */

/**
 * @module moodle-atto_image_alignment-button
 */

/**
 * Atto image selection tool.
 *
 * @namespace M.atto_image
 * @class Button
 * @extends M.editor_atto.EditorPlugin
 */

var CSS = {
        INPUTALIGNMENT: &#x27;atto_image_alignment&#x27;,
        INPUTALT: &#x27;atto_image_altentry&#x27;,
        INPUTHEIGHT: &#x27;atto_image_heightentry&#x27;,
        INPUTSUBMIT: &#x27;atto_image_urlentrysubmit&#x27;,
        INPUTURL: &#x27;atto_image_urlentry&#x27;,
        INPUTWIDTH: &#x27;atto_image_widthentry&#x27;,
        IMAGEALTWARNING: &#x27;atto_image_altwarning&#x27;,
        IMAGEBROWSER: &#x27;openimagebrowser&#x27;,
        IMAGEPRESENTATION: &#x27;atto_image_presentation&#x27;,
        IMAGEPREVIEW: &#x27;atto_image_preview&#x27;
    },
    ALIGNMENTS = [
        // Vertical alignment.
        {
            name: &#x27;baseline&#x27;,
            str: &#x27;alignment_baseline&#x27;,
            value: &#x27;vertical-align&#x27;
        }, {
            name: &#x27;sub&#x27;,
            str: &#x27;alignment_sub&#x27;,
            value: &#x27;vertical-align&#x27;
        }, {
            name: &#x27;super&#x27;,
            str: &#x27;alignment_super&#x27;,
            value: &#x27;vertical-align&#x27;
        }, {
            name: &#x27;top&#x27;,
            str: &#x27;alignment_top&#x27;,
            value: &#x27;vertical-align&#x27;
        }, {
            name: &#x27;text-top&#x27;,
            str: &#x27;alignment_texttop&#x27;,
            value: &#x27;vertical-align&#x27;
        }, {
            name: &#x27;middle&#x27;,
            str: &#x27;alignment_middle&#x27;,
            value: &#x27;vertical-align&#x27;
        }, {
            name: &#x27;bottom&#x27;,
            str: &#x27;alignment_bottom&#x27;,
            value: &#x27;vertical-align&#x27;
        }, {
            name: &#x27;text-bottom&#x27;,
            str: &#x27;alignment_textbottom&#x27;,
            value: &#x27;vertical-align&#x27;
        },

        // Floats.
        {
            name: &#x27;left&#x27;,
            str: &#x27;alignment_left&#x27;,
            value: &#x27;float&#x27;
        }, {
            name: &#x27;right&#x27;,
            str: &#x27;alignment_right&#x27;,
            value: &#x27;float&#x27;
        }
    ];

var COMPONENTNAME = &#x27;atto_image&#x27;,

    TEMPLATE = &#x27;&#x27; +
            &#x27;&lt;form class=&quot;atto_form&quot;&gt;&#x27; +
                &#x27;&lt;label for=&quot;{{elementid}}_{{CSS.INPUTURL}}&quot;&gt;{{get_string &quot;enterurl&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;input class=&quot;fullwidth {{CSS.INPUTURL}}&quot; type=&quot;url&quot; id=&quot;{{elementid}}_{{CSS.INPUTURL}}&quot; size=&quot;32&quot;/&gt;&#x27; +
                &#x27;&lt;br/&gt;&#x27; +

                // Add the repository browser button.
                &#x27;{{#if showFilepicker}}&#x27; +
                    &#x27;&lt;button class=&quot;{{CSS.IMAGEBROWSER}}&quot; type=&quot;button&quot;&gt;{{get_string &quot;browserepositories&quot; component}}&lt;/button&gt;&#x27; +
                &#x27;{{/if}}&#x27; +

                // Add the Alt box.
                &#x27;&lt;div style=&quot;display:none&quot; role=&quot;alert&quot; class=&quot;warning {{CSS.IMAGEALTWARNING}}&quot;&gt;&#x27; +
                    &#x27;{{get_string &quot;presentationoraltrequired&quot; component}}&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;label for=&quot;{{elementid}}_{{CSS.INPUTALT}}&quot;&gt;{{get_string &quot;enteralt&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;input class=&quot;fullwidth {{CSS.INPUTALT}}&quot; type=&quot;text&quot; value=&quot;&quot; id=&quot;{{elementid}}_{{CSS.INPUTALT}}&quot; size=&quot;32&quot;/&gt;&#x27; +
                &#x27;&lt;br/&gt;&#x27; +

                // Add the presentation select box.
                &#x27;&lt;input type=&quot;checkbox&quot; class=&quot;{{CSS.IMAGEPRESENTATION}}&quot; id=&quot;{{elementid}}_{{CSS.IMAGEPRESENTATION}}&quot;/&gt;&#x27; +
                &#x27;&lt;label class=&quot;sameline&quot; for=&quot;{{elementid}}_{{CSS.IMAGEPRESENTATION}}&quot;&gt;{{get_string &quot;presentation&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;br/&gt;&#x27; +

                // Add the width entry box.
                &#x27;&lt;label class=&quot;sameline&quot; for=&quot;{{elementid}}_{{CSS.INPUTWIDTH}}&quot;&gt;{{get_string &quot;width&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;input type=&quot;text&quot; class=&quot;{{CSS.INPUTWIDTH}} id=&quot;{{elementid}}_{{CSS.INPUTWIDTH}}&quot; size=&quot;10&quot;/&gt;&#x27; +
                &#x27;&lt;br/&gt;&#x27; +

                // Add the height entry box.
                &#x27;&lt;label class=&quot;sameline&quot; for=&quot;{{elementid}}_{{CSS.INPUTHEIGHT}}&quot;&gt;{{get_string &quot;height&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;input type=&quot;text&quot; class=&quot;{{CSS.INPUTHEIGHT}}&quot; id=&quot;{{elementid}}_{{CSS.INPUTHEIGHT}}&quot; size=&quot;10&quot;/&gt;&#x27; +
                &#x27;&lt;br/&gt;&#x27; +

                // Add the alignment selector.
                &#x27;&lt;label class=&quot;sameline&quot; for=&quot;{{elementid}}_{{CSS.INPUTALIGNMENT}}&quot;&gt;{{get_string &quot;alignment&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;select class=&quot;{{CSS.INPUTALIGNMENT}}&quot; id=&quot;{{elementid}}_{{CSS.INPUTALIGNMENT}}&quot;&gt;&#x27; +
                    &#x27;{{#each alignments}}&#x27; +
                        &#x27;&lt;option value=&quot;{{value}}:{{name}};&quot;&gt;{{get_string str ../component}}&lt;/option&gt;&#x27; +
                    &#x27;{{/each}}&#x27; +
                &#x27;&lt;/select&gt;&#x27; +
                &#x27;&lt;br/&gt;&#x27; +

                // Add the image preview.
                &#x27;&lt;label for=&quot;{{elementid}}_{{CSS.IMAGEPREVIEW}}&quot;&gt;{{get_string &quot;preview&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;div class=&quot;mdl-align&quot;&gt;&#x27; +
                &#x27;&lt;img src=&quot;#&quot; class=&quot;{{CSS.IMAGEPREVIEW}}&quot; id=&quot;{{elementid}}_{{CSS.IMAGEPREVIEW}}&quot; alt=&quot;&quot; style=&quot;display: none;&quot;/&gt;&#x27; +
                &#x27;&lt;br/&gt;&#x27; +

                // Add the submit button and close the form.
                &#x27;&lt;button class=&quot;{{CSS.INPUTSUBMIT}}&quot; type=&quot;submit&quot;&gt;{{get_string &quot;createimage&quot; component}}&lt;/button&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
            &#x27;&lt;/form&gt;&#x27;,

        IMAGETEMPLATE = &#x27;&#x27; +
            &#x27;&lt;img src=&quot;{{url}}&quot; alt=&quot;{{alt}}&quot; &#x27; +
                &#x27;{{#if width}}width=&quot;{{width}}&quot; {{/if}}&#x27; +
                &#x27;{{#if height}}height=&quot;{{height}}&quot; {{/if}}&#x27; +
                &#x27;{{#if presentation}}role=&quot;presentation&quot; {{/if}}&#x27; +
                &#x27;{{#if alignment}}style=&quot;{{alignment}}&quot; {{/if}}&#x27; +
                &#x27;/&gt;&#x27;;

Y.namespace(&#x27;M.atto_image&#x27;).Button = Y.Base.create(&#x27;button&#x27;, Y.M.editor_atto.EditorPlugin, [], {
    /**
     * A reference to the current selection at the time that the dialogue
     * was opened.
     *
     * @property _currentSelection
     * @type Range
     * @private
     */
    _currentSelection: null,

    /**
     * The most recently selected image.
     *
     * @param _selectedImage
     * @type Node
     * @private
     */
    _selectedImage: null,

    /**
     * A reference to the currently open form.
     *
     * @param _form
     * @type Node
     * @private
     */
    _form: null,

    initializer: function() {
        this.addButton({
            icon: &#x27;e/insert_edit_image&#x27;,
            callback: this._displayDialogue,
            tags: &#x27;img&#x27;,
            tagMatchRequiresAll: false
        });
    },

    /**
     * Display the image editing tool.
     *
     * @method _displayDialogue
     * @private
     */
    _displayDialogue: function() {
        // Store the current selection.
        this._currentSelection = this.get(&#x27;host&#x27;).getSelection();
        if (this._currentSelection === false) {
            return;
        }

        var dialogue = this.getDialogue({
            headerContent: M.util.get_string(&#x27;createimage&#x27;, COMPONENTNAME),
            width: &#x27;480px&#x27;,
            focusAfterHide: true
        });

        // Set the dialogue content, and then show the dialogue.
        dialogue.set(&#x27;bodyContent&#x27;, this._getDialogueContent())
                .show();
    },

    /**
     * Return the dialogue content for the tool, attaching any required
     * events.
     *
     * @method _getDialogueContent
     * @return {Node} The content to place in the dialogue.
     * @private
     */
    _getDialogueContent: function() {
        var template = Y.Handlebars.compile(TEMPLATE),
            content = Y.Node.create(template({
                elementid: this.get(&#x27;host&#x27;).get(&#x27;elementid&#x27;),
                CSS: CSS,
                component: COMPONENTNAME,
                showFilepicker: this.get(&#x27;host&#x27;).canShowFilepicker(&#x27;image&#x27;),
                alignments: ALIGNMENTS
            }));

        this._form = content;

        // Configure the view of the current image.
        this._applyImageProperties(this._form);

        this._form.one(&#x27;.&#x27; + CSS.INPUTURL).on(&#x27;blur&#x27;, this._urlChanged, this);
        this._form.one(&#x27;.&#x27; + CSS.INPUTSUBMIT).on(&#x27;click&#x27;, this._setImage, this);
        this._form.one(&#x27;.&#x27; + CSS.IMAGEBROWSER).on(&#x27;click&#x27;, function() {
                this.get(&#x27;host&#x27;).showFilepicker(&#x27;image&#x27;, this._filepickerCallback, this);
        }, this);

        return content;
    },

    /**
     * Update the dialogue after an image was selected in the File Picker.
     *
     * @method _filepickerCallback
     * @param {object} params The parameters provided by the filepicker
     * containing information about the image.
     * @private
     */
    _filepickerCallback: function(params) {
        if (params.url !== &#x27;&#x27;) {
            var input = this._form.one(&#x27;.&#x27; + CSS.INPUTURL),
                self = this;
            input.set(&#x27;value&#x27;, params.url);

            // Auto set the width and height.
            var image = new Image();
            image.onload = function() {
                self._form.one(&#x27;.&#x27; + CSS.INPUTWIDTH).set(&#x27;value&#x27;, this.width);
                self._form.one(&#x27;.&#x27; + CSS.INPUTHEIGHT).set(&#x27;value&#x27;, this.height);
                self._form.one(&#x27;.&#x27; + CSS.IMAGEPREVIEW).set(&#x27;src&#x27;, this.src);
                self._form.one(&#x27;.&#x27; + CSS.IMAGEPREVIEW).setStyle(&#x27;display&#x27;, &#x27;inline&#x27;);

                // Centre the dialogue once the preview image has loaded.
                self.getDialogue().centerDialogue();
            };
            image.src = params.url;
        }
    },

    /**
     * Applies properties of an existing image to the image dialogue for editing.
     *
     * @method _applyImageProperties
     * @param {Node} form
     * @private
     */
    _applyImageProperties: function(form) {
        var properties = this._getSelectedImageProperties(),
            img = form.one(&#x27;.&#x27; + CSS.IMAGEPREVIEW);

        if (properties === false) {
            img.setStyle(&#x27;display&#x27;, &#x27;none&#x27;);
            return;
        }

        if (properties.align) {
            form.one(&#x27;.&#x27; + CSS.INPUTALIGNMENT).set(&#x27;value&#x27;, properties.align);
        }
        if (properties.display) {
            img.setStyle(&#x27;display&#x27;, properties.display);
        }
        if (properties.width) {
            form.one(&#x27;.&#x27; + CSS.INPUTWIDTH).set(&#x27;value&#x27;, properties.width);
        }
        if (properties.height) {
            form.one(&#x27;.&#x27; + CSS.INPUTHEIGHT).set(&#x27;value&#x27;, properties.height);
        }
        if (properties.alt) {
            form.one(&#x27;.&#x27; + CSS.INPUTALT).set(&#x27;value&#x27;, properties.alt);
        }
        if (properties.src) {
            form.one(&#x27;.&#x27; + CSS.INPUTURL).set(&#x27;value&#x27;, properties.src);
            img.setAttribute(&#x27;src&#x27;, properties.src);
        }
        if (properties.presentation) {
            form.one(&#x27;.&#x27; + CSS.IMAGEPRESENTATION).set(&#x27;checked&#x27;, &#x27;checked&#x27;);
        }
    },

    /**
     * Gets the properties of the currently selected image.
     *
     * The first image only if multiple images are selected.
     *
     * @method _getSelectedImageProperties
     * @return {object}
     * @private
     */
    _getSelectedImageProperties: function() {
        var properties = {
                src: null,
                alt :null,
                width: null,
                height: null,
                align: null,
                display: &#x27;inline&#x27;,
                presentation: false
            },

            // Get the current selection.
            images = this.get(&#x27;host&#x27;).getSelectedNodes(),
            i, width, height, style, css;

        if (images) {
            images = images.filter(&#x27;img&#x27;);
        }

        if (images &amp;&amp; images.size()) {
            image = images.item(0);
            this._selectedImage = image;

            style = image.getAttribute(&#x27;style&#x27;);
            width = parseInt(image.getAttribute(&#x27;width&#x27;), 10);
            height = parseInt(image.getAttribute(&#x27;height&#x27;), 10);

            if (width &gt; 0) {
                properties.width = width;
            }
            if (height &gt; 0) {
                properties.height = height;
            }
            for (i in ALIGNMENTS) {
                css = ALIGNMENTS[i].value + &#x27;:&#x27; + ALIGNMENTS[i].name + &#x27;;&#x27;;
                if (style.replace(&#x27; &#x27;, &#x27;&#x27;).indexOf(css) !== -1) {
                    properties.align = css;
                    break;
                }
            }
            properties.src = image.getAttribute(&#x27;src&#x27;);
            properties.alt = image.getAttribute(&#x27;alt&#x27;) || &#x27;&#x27;;
            properties.presentation = (image.get(&#x27;role&#x27;) === &#x27;presentation&#x27;);
            return properties;
        }

        // No image selected - clean up.
        this._selectedImage = null;
        return false;
    },

    /**
     * Update the form when the URL was changed. This includes updating the
     * height, width, and image preview.
     *
     * @method _urlChanged
     * @private
     */
    _urlChanged: function() {
        var input = this._form.one(&#x27;.&#x27; + CSS.INPUTURL),
            self = this;

        if (input.get(&#x27;value&#x27;) !== &#x27;&#x27;) {
            // Auto set the width and height.
            var image = new Image();
            image.onload = function() {
                var input;

                input = self._form.one(&#x27;.&#x27; + CSS.INPUTWIDTH);
                if (input.get(&#x27;value&#x27;) === &#x27;&#x27;) {
                    input.set(&#x27;value&#x27;, this.width);
                }
                input = self._form.one(&#x27;.&#x27; + CSS.INPUTHEIGHT);
                if (input.get(&#x27;value&#x27;) === &#x27;&#x27;) {
                    input.set(&#x27;value&#x27;, this.height);
                }
                input = self._form.one(&#x27;.&#x27; + CSS.IMAGEPREVIEW);
                input.set(&#x27;src&#x27;, this.src);
                input.setStyle(&#x27;display&#x27;, &#x27;inline&#x27;);

                // Centre the dialogue once the preview image has loaded.
                self.getDialogue().centerDialogue();
            };
            image.src = input.get(&#x27;value&#x27;);
        }
    },

    /**
     * Update the image in the contenteditable.
     *
     * @method _setImage
     * @param {EventFacade} e
     * @private
     */
    _setImage: function(e) {
        var form = this._form,
            url = form.one(&#x27;.&#x27; + CSS.INPUTURL).get(&#x27;value&#x27;),
            alt = form.one(&#x27;.&#x27; + CSS.INPUTALT).get(&#x27;value&#x27;),
            width = form.one(&#x27;.&#x27; + CSS.INPUTWIDTH).get(&#x27;value&#x27;),
            height = form.one(&#x27;.&#x27; + CSS.INPUTHEIGHT).get(&#x27;value&#x27;),
            alignment = form.one(&#x27;.&#x27; + CSS.INPUTALIGNMENT).get(&#x27;value&#x27;),
            presentation = form.one(&#x27;.&#x27; + CSS.IMAGEPRESENTATION).get(&#x27;checked&#x27;),
            imagehtml,
            host = this.get(&#x27;host&#x27;);

        e.preventDefault();

        if (alt === &#x27;&#x27; &amp;&amp; !presentation) {
            form.one(&#x27;.&#x27; + CSS.IMAGEALTWARNING).setStyle(&#x27;display&#x27;, &#x27;block&#x27;);
            form.one(&#x27;.&#x27; + CSS.INPUTALT).setAttribute(&#x27;aria-invalid&#x27;, true);
            form.one(&#x27;.&#x27; + CSS.IMAGEPRESENTATION).setAttribute(&#x27;aria-invalid&#x27;, true);
            return;
        } else {
            form.one(&#x27;.&#x27; + CSS.IMAGEALTWARNING).setStyle(&#x27;display&#x27;, &#x27;none&#x27;);
            form.one(&#x27;.&#x27; + CSS.INPUTALT).setAttribute(&#x27;aria-invalid&#x27;, false);
            form.one(&#x27;.&#x27; + CSS.IMAGEPRESENTATION).setAttribute(&#x27;aria-invalid&#x27;, false);
        }

        this.getDialogue({
            focusAfterHide: null
        }).hide();

        // Focus on the editor in preparation for inserting the image.
        host.focus();
        if (url !== &#x27;&#x27;) {
            if (this._selectedImage) {
                host.setSelection(host.getSelectionFromNode(this._selectedImage));
            } else {
                host.setSelection(this._currentSelection);
            }
            template = Y.Handlebars.compile(IMAGETEMPLATE);
            imagehtml = template({
                url: url,
                alt: alt,
                width: width,
                height: height,
                presentation: presentation,
                alignment: alignment
            });

            this.get(&#x27;host&#x27;).insertContentAtFocusPoint(imagehtml);

            this.markUpdated();
        }
    }
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
