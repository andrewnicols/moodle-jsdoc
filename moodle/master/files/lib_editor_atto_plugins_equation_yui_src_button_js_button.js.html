<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/editor/atto/plugins/equation/yui/src/button/js/button.js - Moodle</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Moodle"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.7dev (Build: 20140320)</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Bootstrap.Collapse.html">Bootstrap.Collapse</a></li>
            
                <li><a href="../classes/Bootstrap.Dropdown.html">Bootstrap.Dropdown</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotation.html">M.assignfeedback_editpdf.annotation</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationhighlight.html">M.assignfeedback_editpdf.annotationhighlight</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationline.html">M.assignfeedback_editpdf.annotationline</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationoval.html">M.assignfeedback_editpdf.annotationoval</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationpen.html">M.assignfeedback_editpdf.annotationpen</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationrectangle.html">M.assignfeedback_editpdf.annotationrectangle</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.annotationstamp.html">M.assignfeedback_editpdf.annotationstamp</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.colourpicker.html">M.assignfeedback_editpdf.colourpicker</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.comment.html">M.assignfeedback_editpdf.comment</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.commentmenu.html">M.assignfeedback_editpdf.commentmenu</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.commentsearch.html">M.assignfeedback_editpdf.commentsearch</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.drawable.html">M.assignfeedback_editpdf.drawable</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.dropdown.html">M.assignfeedback_editpdf.dropdown</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.edit.html">M.assignfeedback_editpdf.edit</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.editor.html">M.assignfeedback_editpdf.editor</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.point.html">M.assignfeedback_editpdf.point</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.quickcomment.html">M.assignfeedback_editpdf.quickcomment</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.quickcommentlist.html">M.assignfeedback_editpdf.quickcommentlist</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.rect.html">M.assignfeedback_editpdf.rect</a></li>
            
                <li><a href="../classes/M.assignfeedback_editpdf.stamppicker.html">M.assignfeedback_editpdf.stamppicker</a></li>
            
                <li><a href="../classes/M.atto_accessibilitychecker.Button.html">M.atto_accessibilitychecker.Button</a></li>
            
                <li><a href="../classes/M.atto_accessibilityhelper.Button.html">M.atto_accessibilityhelper.Button</a></li>
            
                <li><a href="../classes/M.atto_align.button.html">M.atto_align.button</a></li>
            
                <li><a href="../classes/M.atto_backcolor.button.html">M.atto_backcolor.button</a></li>
            
                <li><a href="../classes/M.atto_bold.button.html">M.atto_bold.button</a></li>
            
                <li><a href="../classes/M.atto_charmap.button.html">M.atto_charmap.button</a></li>
            
                <li><a href="../classes/M.atto_clear.button.html">M.atto_clear.button</a></li>
            
                <li><a href="../classes/M.atto_collapse.button.html">M.atto_collapse.button</a></li>
            
                <li><a href="../classes/M.atto_emoticon.button.html">M.atto_emoticon.button</a></li>
            
                <li><a href="../classes/M.atto_equation.Button.html">M.atto_equation.Button</a></li>
            
                <li><a href="../classes/M.atto_fontcolor.button.html">M.atto_fontcolor.button</a></li>
            
                <li><a href="../classes/M.atto_html.button.html">M.atto_html.button</a></li>
            
                <li><a href="../classes/M.atto_image.Button.html">M.atto_image.Button</a></li>
            
                <li><a href="../classes/M.atto_indent.button.html">M.atto_indent.button</a></li>
            
                <li><a href="../classes/M.atto_italic.button.html">M.atto_italic.button</a></li>
            
                <li><a href="../classes/M.atto_link.button.html">M.atto_link.button</a></li>
            
                <li><a href="../classes/M.atto_managefiles.usedfiles.html">M.atto_managefiles.usedfiles</a></li>
            
                <li><a href="../classes/M.atto_media.Button.html">M.atto_media.Button</a></li>
            
                <li><a href="../classes/M.atto_noautolink.button.html">M.atto_noautolink.button</a></li>
            
                <li><a href="../classes/M.atto_orderedlist.button.html">M.atto_orderedlist.button</a></li>
            
                <li><a href="../classes/M.atto_rtl.button.html">M.atto_rtl.button</a></li>
            
                <li><a href="../classes/M.atto_strike.button.html">M.atto_strike.button</a></li>
            
                <li><a href="../classes/M.atto_subscript.button.html">M.atto_subscript.button</a></li>
            
                <li><a href="../classes/M.atto_superscript.button.html">M.atto_superscript.button</a></li>
            
                <li><a href="../classes/M.atto_table.Button.html">M.atto_table.Button</a></li>
            
                <li><a href="../classes/M.atto_title.button.html">M.atto_title.button</a></li>
            
                <li><a href="../classes/M.atto_underline.button.html">M.atto_underline.button</a></li>
            
                <li><a href="../classes/M.atto_undo.button.html">M.atto_undo.button</a></li>
            
                <li><a href="../classes/M.atto_unlink.button.html">M.atto_unlink.button</a></li>
            
                <li><a href="../classes/M.atto_unorderedlist.button.html">M.atto_unorderedlist.button</a></li>
            
                <li><a href="../classes/M.block_navigation.html">M.block_navigation</a></li>
            
                <li><a href="../classes/M.block_navigation.ActionKey.html">M.block_navigation.ActionKey</a></li>
            
                <li><a href="../classes/M.block_navigation.Branch.html">M.block_navigation.Branch</a></li>
            
                <li><a href="../classes/M.block_navigation.Tree.html">M.block_navigation.Tree</a></li>
            
                <li><a href="../classes/M.core.actionmenu.ActionMenu.html">M.core.actionmenu.ActionMenu</a></li>
            
                <li><a href="../classes/M.core.ajaxException.html">M.core.ajaxException</a></li>
            
                <li><a href="../classes/M.core.alert.html">M.core.alert</a></li>
            
                <li><a href="../classes/M.core.blockdraganddrop.BlockRegion.html">M.core.blockdraganddrop.BlockRegion</a></li>
            
                <li><a href="../classes/M.core.blockdraganddrop.LegacyManager.html">M.core.blockdraganddrop.LegacyManager</a></li>
            
                <li><a href="../classes/M.core.blockdraganddrop.Manager.html">M.core.blockdraganddrop.Manager</a></li>
            
                <li><a href="../classes/M.core.chooserdialogue.html">M.core.chooserdialogue</a></li>
            
                <li><a href="../classes/M.core.confirm.html">M.core.confirm</a></li>
            
                <li><a href="../classes/M.core.dialogue.html">M.core.dialogue</a></li>
            
                <li><a href="../classes/M.core.dock.ActionKey.html">M.core.dock.ActionKey</a></li>
            
                <li><a href="../classes/M.core.dock.Block.html">M.core.dock.Block</a></li>
            
                <li><a href="../classes/M.core.dock.Dock.html">M.core.dock.Dock</a></li>
            
                <li><a href="../classes/M.core.dock.DockedItem.html">M.core.dock.DockedItem</a></li>
            
                <li><a href="../classes/M.core.dock.Loader.html">M.core.dock.Loader</a></li>
            
                <li><a href="../classes/M.core.dock.Panel.html">M.core.dock.Panel</a></li>
            
                <li><a href="../classes/M.core.dock.TabHeightManager.html">M.core.dock.TabHeightManager</a></li>
            
                <li><a href="../classes/M.core.dragdrop.html">M.core.dragdrop</a></li>
            
                <li><a href="../classes/M.core.exception.html">M.core.exception</a></li>
            
                <li><a href="../classes/M.core.formchangechecker.html">M.core.formchangechecker</a></li>
            
                <li><a href="../classes/M.core.LockScroll.html">M.core.LockScroll</a></li>
            
                <li><a href="../classes/M.core.notification.html">M.core.notification</a></li>
            
                <li><a href="../classes/M.core.notification.info.html">M.core.notification.info</a></li>
            
                <li><a href="../classes/M.core.popuphelp.html">M.core.popuphelp</a></li>
            
                <li><a href="../classes/M.core.tooltip.html">M.core.tooltip</a></li>
            
                <li><a href="../classes/M.core.WidgetFocusAfterHide.html">M.core.WidgetFocusAfterHide</a></li>
            
                <li><a href="../classes/M.core_backup.backupselectall.html">M.core_backup.backupselectall</a></li>
            
                <li><a href="../classes/M.core_backup.confirmcancel.html">M.core_backup.confirmcancel</a></li>
            
                <li><a href="../classes/M.course.coursebase.html">M.course.coursebase</a></li>
            
                <li><a href="../classes/M.course.dragdrop.resource.html">M.course.dragdrop.resource</a></li>
            
                <li><a href="../classes/M.course.dragdrop.section.html">M.course.dragdrop.section</a></li>
            
                <li><a href="../classes/M.course.management.Category.html">M.course.management.Category</a></li>
            
                <li><a href="../classes/M.course.management.Console.html">M.course.management.Console</a></li>
            
                <li><a href="../classes/M.course.management.Course.html">M.course.management.Course</a></li>
            
                <li><a href="../classes/M.course.management.DragDrop.html">M.course.management.DragDrop</a></li>
            
                <li><a href="../classes/M.course.management.Item.html">M.course.management.Item</a></li>
            
                <li><a href="../classes/M.course.modchooser.html">M.course.modchooser</a></li>
            
                <li><a href="../classes/M.course.toolboxes.resources.html">M.course.toolboxes.resources</a></li>
            
                <li><a href="../classes/M.course.toolboxes.section.html">M.course.toolboxes.section</a></li>
            
                <li><a href="../classes/M.course.toolboxes.toolbox.html">M.course.toolboxes.toolbox</a></li>
            
                <li><a href="../classes/M.editor_atto.Editor.html">M.editor_atto.Editor</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorClean.html">M.editor_atto.EditorClean</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorFilepicker.html">M.editor_atto.EditorFilepicker</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorPlugin.html">M.editor_atto.EditorPlugin</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorPluginButtons.html">M.editor_atto.EditorPluginButtons</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorPluginDialogue.html">M.editor_atto.EditorPluginDialogue</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorSelection.html">M.editor_atto.EditorSelection</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorStyling.html">M.editor_atto.EditorStyling</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorTextArea.html">M.editor_atto.EditorTextArea</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorToolbar.html">M.editor_atto.EditorToolbar</a></li>
            
                <li><a href="../classes/M.editor_atto.EditorToolbarNav.html">M.editor_atto.EditorToolbarNav</a></li>
            
                <li><a href="../classes/M.editor_atto.Menu.html">M.editor_atto.Menu</a></li>
            
                <li><a href="../classes/M.form.shortforms.html">M.form.shortforms</a></li>
            
                <li><a href="../classes/M.form.showadvanced.html">M.form.showadvanced</a></li>
            
                <li><a href="../classes/M.mod_quiz.autosave.html">M.mod_quiz.autosave</a></li>
            
                <li><a href="../classes/M.tool_capability.Search.html">M.tool_capability.Search</a></li>
            
                <li><a href="../classes/Moodle.core_course.util.html">Moodle.core_course.util</a></li>
            
                <li><a href="../classes/Moodle.core_course.util.cm.html">Moodle.core_course.util.cm</a></li>
            
                <li><a href="../classes/Moodle.core_course.util.section.html">Moodle.core_course.util.section</a></li>
            
                <li><a href="../classes/Moodle.theme_bootstrapbase.bootstrap.html">Moodle.theme_bootstrapbase.bootstrap</a></li>
            
                <li><a href="../classes/Y.BootstrapEngine.html">Y.BootstrapEngine</a></li>
            
                <li><a href="../classes/Y.Moodle.course.categoryexpander.html">Y.Moodle.course.categoryexpander</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/buttons.html">buttons</a></li>
            
                <li><a href="../modules/clean.html">clean</a></li>
            
                <li><a href="../modules/dialogue.html">dialogue</a></li>
            
                <li><a href="../modules/filepicker.html">filepicker</a></li>
            
                <li><a href="../modules/gallery-bootstrap-collapse.html">gallery-bootstrap-collapse</a></li>
            
                <li><a href="../modules/gallery-bootstrap-dropdown.html">gallery-bootstrap-dropdown</a></li>
            
                <li><a href="../modules/gallery-bootstrap-engine.html">gallery-bootstrap-engine</a></li>
            
                <li><a href="../modules/menu-base.html">menu-base</a></li>
            
                <li><a href="../modules/moodle-assignfeedback_editpdf-editor.html">moodle-assignfeedback_editpdf-editor</a></li>
            
                <li><a href="../modules/moodle-atto-managefiles-button.html">moodle-atto-managefiles-button</a></li>
            
                <li><a href="../modules/moodle-atto_accessibilitychecker-button.html">moodle-atto_accessibilitychecker-button</a></li>
            
                <li><a href="../modules/moodle-atto_accessibilityhelper-button.html">moodle-atto_accessibilityhelper-button</a></li>
            
                <li><a href="../modules/moodle-atto_align-button.html">moodle-atto_align-button</a></li>
            
                <li><a href="../modules/moodle-atto_backcolor-button.html">moodle-atto_backcolor-button</a></li>
            
                <li><a href="../modules/moodle-atto_bold-button.html">moodle-atto_bold-button</a></li>
            
                <li><a href="../modules/moodle-atto_charmap-button.html">moodle-atto_charmap-button</a></li>
            
                <li><a href="../modules/moodle-atto_clear-button.html">moodle-atto_clear-button</a></li>
            
                <li><a href="../modules/moodle-atto_collapse-button.html">moodle-atto_collapse-button</a></li>
            
                <li><a href="../modules/moodle-atto_emoticon-button.html">moodle-atto_emoticon-button</a></li>
            
                <li><a href="../modules/moodle-atto_html-button.html">moodle-atto_html-button</a></li>
            
                <li><a href="../modules/moodle-atto_image_alignment-button.html">moodle-atto_image_alignment-button</a></li>
            
                <li><a href="../modules/moodle-atto_indent-button.html">moodle-atto_indent-button</a></li>
            
                <li><a href="../modules/moodle-atto_italic-button.html">moodle-atto_italic-button</a></li>
            
                <li><a href="../modules/moodle-atto_link-button.html">moodle-atto_link-button</a></li>
            
                <li><a href="../modules/moodle-atto_managefiles-usedfiles.html">moodle-atto_managefiles-usedfiles</a></li>
            
                <li><a href="../modules/moodle-atto_media-button.html">moodle-atto_media-button</a></li>
            
                <li><a href="../modules/moodle-atto_noautolink-button.html">moodle-atto_noautolink-button</a></li>
            
                <li><a href="../modules/moodle-atto_orderedlist-button.html">moodle-atto_orderedlist-button</a></li>
            
                <li><a href="../modules/moodle-atto_rtl-button.html">moodle-atto_rtl-button</a></li>
            
                <li><a href="../modules/moodle-atto_strike-button.html">moodle-atto_strike-button</a></li>
            
                <li><a href="../modules/moodle-atto_subscript-button.html">moodle-atto_subscript-button</a></li>
            
                <li><a href="../modules/moodle-atto_superscript-button.html">moodle-atto_superscript-button</a></li>
            
                <li><a href="../modules/moodle-atto_table-button.html">moodle-atto_table-button</a></li>
            
                <li><a href="../modules/moodle-atto_title-button.html">moodle-atto_title-button</a></li>
            
                <li><a href="../modules/moodle-atto_underline-button.html">moodle-atto_underline-button</a></li>
            
                <li><a href="../modules/moodle-atto_undo-button.html">moodle-atto_undo-button</a></li>
            
                <li><a href="../modules/moodle-atto_unlink-button.html">moodle-atto_unlink-button</a></li>
            
                <li><a href="../modules/moodle-atto_unorderedlist-button.html">moodle-atto_unorderedlist-button</a></li>
            
                <li><a href="../modules/moodle-backup-backupselectall.html">moodle-backup-backupselectall</a></li>
            
                <li><a href="../modules/moodle-backup-confirmcancel.html">moodle-backup-confirmcancel</a></li>
            
                <li><a href="../modules/moodle-block_navigation-navigation.html">moodle-block_navigation-navigation</a></li>
            
                <li><a href="../modules/moodle-core-actionmenu.html">moodle-core-actionmenu</a></li>
            
                <li><a href="../modules/moodle-core-blockdraganddrop.html">moodle-core-blockdraganddrop</a></li>
            
                <li><a href="../modules/moodle-core-chooserdialogue.html">moodle-core-chooserdialogue</a></li>
            
                <li><a href="../modules/moodle-core-dock.html">moodle-core-dock</a></li>
            
                <li><a href="../modules/moodle-core-dragdrop.html">moodle-core-dragdrop</a></li>
            
                <li><a href="../modules/moodle-core-formchangechecker.html">moodle-core-formchangechecker</a></li>
            
                <li><a href="../modules/moodle-core-lockscroll.html">moodle-core-lockscroll</a></li>
            
                <li><a href="../modules/moodle-core-maintenancemodetimer.html">moodle-core-maintenancemodetimer</a></li>
            
                <li><a href="../modules/moodle-core-notification.html">moodle-core-notification</a></li>
            
                <li><a href="../modules/moodle-core-notification-ajaxexception.html">moodle-core-notification-ajaxexception</a></li>
            
                <li><a href="../modules/moodle-core-notification-alert.html">moodle-core-notification-alert</a></li>
            
                <li><a href="../modules/moodle-core-notification-confirm.html">moodle-core-notification-confirm</a></li>
            
                <li><a href="../modules/moodle-core-notification-dialogue.html">moodle-core-notification-dialogue</a></li>
            
                <li><a href="../modules/moodle-core-notification-exception.html">moodle-core-notification-exception</a></li>
            
                <li><a href="../modules/moodle-core-popuphelp.html">moodle-core-popuphelp</a></li>
            
                <li><a href="../modules/moodle-core-tooltip.html">moodle-core-tooltip</a></li>
            
                <li><a href="../modules/moodle-core-widget-focusafterhide.html">moodle-core-widget-focusafterhide</a></li>
            
                <li><a href="../modules/moodle-course-categoryexpander.html">moodle-course-categoryexpander</a></li>
            
                <li><a href="../modules/moodle-course-coursebase.html">moodle-course-coursebase</a></li>
            
                <li><a href="../modules/moodle-course-dragdrop.html">moodle-course-dragdrop</a></li>
            
                <li><a href="../modules/moodle-course-management.html">moodle-course-management</a></li>
            
                <li><a href="../modules/moodle-course-modchooser.html">moodle-course-modchooser</a></li>
            
                <li><a href="../modules/moodle-course-toolboxes.html">moodle-course-toolboxes</a></li>
            
                <li><a href="../modules/moodle-course-util.html">moodle-course-util</a></li>
            
                <li><a href="../modules/moodle-course-util-cm.html">moodle-course-util-cm</a></li>
            
                <li><a href="../modules/moodle-course-util-section.html">moodle-course-util-section</a></li>
            
                <li><a href="../modules/moodle-editor_atto-editor.html">moodle-editor_atto-editor</a></li>
            
                <li><a href="../modules/moodle-editor_atto-menu.html">moodle-editor_atto-menu</a></li>
            
                <li><a href="../modules/moodle-editor_atto-plugin.html">moodle-editor_atto-plugin</a></li>
            
                <li><a href="../modules/moodle-form-shortforms.html">moodle-form-shortforms</a></li>
            
                <li><a href="../modules/moodle-form-showadvanced.html">moodle-form-showadvanced</a></li>
            
                <li><a href="../modules/moodle-mod_quiz-autosave.html">moodle-mod_quiz-autosave</a></li>
            
                <li><a href="../modules/moodle-question-preview.html">moodle-question-preview</a></li>
            
                <li><a href="../modules/moodle-tool_capability-search.html">moodle-tool_capability-search</a></li>
            
                <li><a href="../modules/plugin-base.html">plugin-base</a></li>
            
                <li><a href="../modules/styling.html">styling</a></li>
            
                <li><a href="../modules/textarea.html">textarea</a></li>
            
                <li><a href="../modules/theme_bootstrapbase-bootstrap.html">theme_bootstrapbase-bootstrap</a></li>
            
                <li><a href="../modules/toolbar.html">toolbar</a></li>
            
                <li><a href="../modules/toolbarnav.html">toolbarnav</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/editor/atto/plugins/equation/yui/src/button/js/button.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

/**
 * @package    atto_equation
 * @copyright  2013 Damyon Wiese  &lt;damyon@moodle.com&gt;
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */

/**
 * Atto text editor equation plugin.
 */

/**
 * Atto equation editor.
 *
 * @namespace M.atto_equation
 * @class Button
 * @extends M.editor_atto.EditorPlugin
 */

var COMPONENTNAME = &#x27;atto_equation&#x27;,
    CSS = {
        EQUATION_TEXT: &#x27;atto_equation_equation&#x27;,
        EQUATION_PREVIEW: &#x27;atto_equation_preview&#x27;,
        SUBMIT: &#x27;atto_equation_submit&#x27;,
        LIBRARY: &#x27;atto_equation_library&#x27;,
        LIBRARY_GROUP_PREFIX: &#x27;atto_equation_library&#x27;
    },
    SELECTORS = {
        LIBRARY_GROUP_PREFIX: &#x27;.&#x27; + CSS.LIBRARY_GROUP_PREFIX,
        EQUATION_TEXT: &#x27;.&#x27; + CSS.EQUATION_TEXT,
        EQUATION_PREVIEW: &#x27;.&#x27; + CSS.EQUATION_PREVIEW,
        SUBMIT: &#x27;.&#x27; + CSS.SUBMIT,
        LIBRARY_BUTTON: &#x27;.&#x27; + CSS.LIBRARY + &#x27; button&#x27;
    },
    TEMPLATES = {
        FORM: &#x27;&#x27; +
            &#x27;&lt;form class=&quot;atto_form&quot;&gt;&#x27; +
                &#x27;{{{library}}}&#x27; +
                &#x27;&lt;label for=&quot;{{elementid}}_{{CSS.EQUATION_TEXT}}&quot;&gt;{{get_string &quot;editequation&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;textarea class=&quot;fullwidth {{CSS.EQUATION_TEXT}}&quot; id=&quot;{{elementid}}_{{CSS.EQUATION_TEXT}}&quot; rows=&quot;8&quot;&gt;&lt;/textarea&gt;&lt;br/&gt;&#x27; +
                &#x27;&lt;p&gt;{{{get_string &quot;editequation_desc&quot; component}}}&lt;/p&gt;&#x27; +
                &#x27;&lt;label for=&quot;{{elementid}}_{{CSS.EQUATION_PREVIEW}}&quot;&gt;{{get_string &quot;preview&quot; component}}&lt;/label&gt;&#x27; +
                &#x27;&lt;div class=&quot;fullwidth {{CSS.EQUATION_PREVIEW}}&quot; id=&quot;{{elementid}}_{{CSS.EQUATION_PREVIEW}}&quot;&gt;&lt;/div&gt;&#x27; +
                &#x27;&lt;div class=&quot;mdl-align&quot;&gt;&#x27; +
                    &#x27;&lt;br/&gt;&#x27; +
                    &#x27;&lt;button class=&quot;{{CSS.SUBMIT}}&quot;&gt;{{get_string &quot;saveequation&quot; component}}&lt;/button&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
            &#x27;&lt;/form&gt;&#x27;,
        LIBRARY: &#x27;&#x27; +
            &#x27;&lt;div class=&quot;{{CSS.LIBRARY}}&quot;&gt;&#x27; +
                &#x27;&lt;ul&gt;&#x27; +
                    &#x27;{{#each library}}&#x27; +
                        &#x27;&lt;li&gt;&lt;a href=&quot;#{{elementid}}_{{../CSS.LIBRARY_GROUP_PREFIX}}{{@key}}&quot;&gt;{{get_string groupname ../component}}&lt;/a&gt;&lt;/li&gt;&#x27; +
                    &#x27;{{/each}}&#x27; +
                &#x27;&lt;/ul&gt;&#x27; +
                &#x27;&lt;div&gt;&#x27; +
                    &#x27;{{#each library}}&#x27; +
                        &#x27;&lt;div id=&quot;{{elementid}}_{{../CSS.LIBRARY_GROUP_PREFIX}}{{@key}}&quot;&gt;&#x27; +
                        &#x27;{{#split &quot;\n&quot; elements}}&#x27; +
                            &#x27;&lt;button data-tex=&quot;{{this}}&quot; title=&quot;{{this}}&quot;&gt;$${{this}}$$&lt;/button&gt;&#x27; +
                        &#x27;{{/split}}&#x27; +
                        &#x27;&lt;/div&gt;&#x27; +
                    &#x27;{{/each}}&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
            &#x27;&lt;/div&gt;&#x27;
    };

Y.namespace(&#x27;M.atto_equation&#x27;).Button = Y.Base.create(&#x27;button&#x27;, Y.M.editor_atto.EditorPlugin, [], {

    /**
     * The selection object returned by the browser.
     *
     * @property _currentSelection
     * @type Range
     * @default null
     * @private
     */
    _currentSelection: null,

    /**
     * The cursor position in the equation textarea.
     *
     * @property _lastCursorPos
     * @type Number
     * @default 0
     * @private
     */
    _lastCursorPos: 0,

    /**
     * A reference to the dialogue content.
     *
     * @property _content
     * @type Node
     * @private
     */
    _content: null,

    initializer: function() {
        if (this.get(&#x27;texfilteractive&#x27;)) {
            // Add the button to the toolbar.
            this.addButton({
                icon: &#x27;e/math&#x27;,
                callback: this._displayDialogue
            });

            // We need custom highlight logic for this button.
            this.get(&#x27;host&#x27;).on(&#x27;atto:selectionchanged&#x27;, function() {
                if (this._resolveEquation()) {
                    this.highlightButtons();
                } else {
                    this.unHighlightButtons();
                }
            }, this);
        }
    },

    /**
     * Display the equation editor.
     *
     * @method _displayDialogue
     * @private
     */
    _displayDialogue: function() {
        this._currentSelection = this.get(&#x27;host&#x27;).getSelection();

        if (this._currentSelection === false) {
            return;
        }

        var dialogue = this.getDialogue({
            headerContent: M.util.get_string(&#x27;pluginname&#x27;, COMPONENTNAME),
            focusAfterHide: true
        });

        var content = this._getDialogueContent();
        dialogue.set(&#x27;bodyContent&#x27;, content);

        var library = content.one(SELECTORS.LIBRARY_GROUP_PREFIX);

        var tabview = new Y.TabView({
            srcNode: library
        });

        tabview.render();
        dialogue.show();

        var equation = this._resolveEquation();
        if (equation) {
            content.one(SELECTORS.EQUATION_TEXT).set(&#x27;text&#x27;, equation);
        }
        this._updatePreview(false);
    },

    /**
     * If there is selected text and it is part of an equation,
     * extract the equation (and set it in the form).
     *
     * @method _resolveEquation
     * @private
     * @return {String|Boolean} The equation or false.
     */
    _resolveEquation: function() {

        // Find the equation in the surrounding text.
        var selectedNode = this.get(&#x27;host&#x27;).getSelectionParentNode(),
            text,
            equation;

        // Note this is a document fragment and YUI doesn&#x27;t like them.
        if (!selectedNode) {
            return false;
        }

        text = Y.one(selectedNode).get(&#x27;text&#x27;);
        // We use space or not space because . does not match new lines.
        pattern = /\$\$[\S\s]*\$\$/;
        equation = pattern.exec(text);
        if (equation &amp;&amp; equation.length) {
            equation = equation.pop();
            // Replace the equation.
            equation = equation.substring(2, equation.length - 2);
            return equation;
        }
        return false;
    },

    /**
     * Handle insertion of a new equation, or update of an existing one.
     *
     * @method _setEquation
     * @param {EventFacade} e
     * @private
     */
    _setEquation: function(e) {
        var input,
            selectedNode,
            text,
            pattern,
            equation,
            value;

        var host = this.get(&#x27;host&#x27;);

        e.preventDefault();
        this.getDialogue({
            focusAfterHide: null
        }).hide();

        input = e.currentTarget.ancestor(&#x27;.atto_form&#x27;).one(&#x27;textarea&#x27;);

        value = input.get(&#x27;value&#x27;);
        if (value !== &#x27;&#x27;) {
            host.setSelection(this._currentSelection);

            value = &#x27;$$ &#x27; + value.trim() + &#x27; $$&#x27;;
            selectedNode = Y.one(host.getSelectionParentNode());
            text = selectedNode.get(&#x27;text&#x27;);
            pattern = /\$\$[\S\s]*\$\$/;
            equation = pattern.exec(text);
            if (equation &amp;&amp; equation.length) {
                // Replace the equation.
                equation = equation.pop();
                text = text.replace(equation, &#x27;$$&#x27; + value + &#x27;$$&#x27;);
                selectedNode.set(&#x27;text&#x27;, text);
            } else {
                // Insert the new equation.
                host.insertContentAtFocusPoint(value);
            }

            // Clean the YUI ids from the HTML.
            this.markUpdated();
        }
    },

    /**
     * Update the preview div to match the current equation.
     *
     * @param {EventFacade} e
     * @method _updatePreview
     * @private
     */
    _updatePreview: function(e) {
        var textarea = this._content.one(SELECTORS.EQUATION_TEXT),
            equation = textarea.get(&#x27;value&#x27;),
            url,
            preview,
            currentPos = textarea.get(&#x27;selectionStart&#x27;),
            prefix = &#x27;&#x27;,
            cursorLatex = &#x27;\\square &#x27;,
            isChar;


        if (e) {
            e.preventDefault();
        }

        if (!currentPos) {
            currentPos = 0;
        }
        // Move the cursor so it does not break expressions.
        //
        while (equation.charAt(currentPos) === &#x27;\\&#x27; &amp;&amp; currentPos &gt; 0) {
            currentPos -= 1;
        }
        isChar = /[\w\{\}]/;
        while (isChar.test(equation.charAt(currentPos)) &amp;&amp; currentPos &lt; equation.length) {
            currentPos += 1;
        }
        // Save the cursor position - for insertion from the library.
        this._lastCursorPos = currentPos;
        equation = prefix + equation.substring(0, currentPos) + cursorLatex + equation.substring(currentPos);
        url = M.cfg.wwwroot + &#x27;/lib/editor/atto/plugins/equation/ajax.php&#x27;;
        params = {
            sesskey: M.cfg.sesskey,
            contextid: this.get(&#x27;contextid&#x27;),
            action: &#x27;filtertext&#x27;,
            text: &#x27;$$ &#x27; + equation + &#x27; $$&#x27;
        };

        preview = Y.io(url, { sync: true,
                              data: params });
        if (preview.status === 200) {
            this._content.one(SELECTORS.EQUATION_PREVIEW).setHTML(preview.responseText);
        }
    },

    /**
     * Return the dialogue content for the tool, attaching any required
     * events.
     *
     * @method _getDialogueContent
     * @return {Node}
     * @private
     */
    _getDialogueContent: function() {
        var library = this._getLibraryContent(),
            template = Y.Handlebars.compile(TEMPLATES.FORM);

        this._content = Y.Node.create(template({
            elementid: this.get(&#x27;host&#x27;).get(&#x27;elementid&#x27;),
            component: COMPONENTNAME,
            library: library,
            CSS: CSS
        }));

        this._content.one(SELECTORS.SUBMIT).on(&#x27;click&#x27;, this._setEquation, this);
        this._content.one(SELECTORS.EQUATION_TEXT).on(&#x27;valuechange&#x27;, this._updatePreview, this);
        this._content.one(SELECTORS.EQUATION_TEXT).on(&#x27;mouseup&#x27;, this._updatePreview, this);
        this._content.one(SELECTORS.EQUATION_TEXT).on(&#x27;keyup&#x27;, this._updatePreview, this);
        this._content.delegate(&#x27;click&#x27;, this._selectLibraryItem, SELECTORS.LIBRARY_BUTTON, this);

        return this._content;
    },

    /**
     * Reponse to button presses in the TeX library panels.
     *
     * @method _selectLibraryItem
     * @param {EventFacade} e
     * @return {string}
     * @private
     */
    _selectLibraryItem: function(e) {
        var tex = e.currentTarget.getAttribute(&#x27;data-tex&#x27;);

        e.preventDefault();

        input = e.currentTarget.ancestor(&#x27;.atto_form&#x27;).one(&#x27;textarea&#x27;);

        value = input.get(&#x27;value&#x27;);

        value = value.substring(0, this._lastCursorPos) + tex + value.substring(this._lastCursorPos, value.length);

        input.set(&#x27;value&#x27;, value);
        input.focus();

        var focusPoint = this._lastCursorPos + tex.length,
            realInput = input.getDOMNode();
        if (typeof realInput.selectionStart === &quot;number&quot;) {
            // Modern browsers have selectionStart and selectionEnd to control the cursor position.
            realInput.selectionStart = realInput.selectionEnd = focusPoint;
        } else if (typeof realInput.createTextRange !== &quot;undefined&quot;) {
            // Legacy browsers (IE&lt;=9) use createTextRange().
            var range = realInput.createTextRange();
            range.moveToPoint(focusPoint);
            range.select();
        }
        // Focus must be set before updating the preview for the cursor box to be in the correct location.
        this._updatePreview(false);
    },

    /**
     * Return the HTML for rendering the library of predefined buttons.
     *
     * @method _getLibraryContent
     * @return {string}
     * @private
     */
    _getLibraryContent: function() {
        var template = Y.Handlebars.compile(TEMPLATES.LIBRARY),
            library = this.get(&#x27;library&#x27;),
            content = &#x27;&#x27;;

        // Helper to iterate over a newline separated string.
        Y.Handlebars.registerHelper(&#x27;split&#x27;, function(delimiter, str, options) {
            var parts,
                current,
                out;
            if (typeof delimiter === &quot;undefined&quot; || typeof str === &quot;undefined&quot;) {
                Y.log(&#x27;Handlebars split helper: String and delimiter are required.&#x27;, &#x27;debug&#x27;, &#x27;moodle-atto_equation-button&#x27;);
                return &#x27;&#x27;;
            }

            out = &#x27;&#x27;;
            parts = str.trim().split(delimiter);
            while (parts.length &gt; 0) {
                current = parts.shift();
                out += options.fn(current);
            }

            return out;
        });
        content = template({
            elementid: this.get(&#x27;host&#x27;).get(&#x27;elementid&#x27;),
            component: COMPONENTNAME,
            library: library,
            CSS: CSS
        });

        var url = M.cfg.wwwroot + &#x27;/lib/editor/atto/plugins/equation/ajax.php&#x27;;
        var params = {
            sesskey: M.cfg.sesskey,
            contextid: this.get(&#x27;contextid&#x27;),
            action: &#x27;filtertext&#x27;,
            text: content
        };

        preview = Y.io(url, {
            sync: true,
            data: params,
            method: &#x27;POST&#x27;
        });

        if (preview.status === 200) {
            content = preview.responseText;
        }
        return content;
    }
}, {
    ATTRS: {
        /**
         * Whether the TeX filter is currently active.
         *
         * @attribute texfilteractive
         * @type Boolean
         */
        texfilteractive: {
            value: false
        },
        /**
         * The contextid to use when generating this preview.
         *
         * @attribute contextid
         * @type String
         */
        contextid: {
            value: null
        },

        /**
         * The content of the example library.
         *
         * @attribute library
         * @type object
         */
        library: {
            value: {}
        }
    }
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
